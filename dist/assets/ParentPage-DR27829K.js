import{u as U,a as W,r as l,s as C,j as e}from"./index-SEf-vp2y.js";const t={back:"â†",child:"ðŸ‘¦",chart:"ðŸ“Š",device:"ðŸ“±",crown:"ðŸ‘‘",settings:"âš™ï¸",fire:"ðŸ”¥",star:"â­",book:"ðŸ“š",game:"ðŸŽ®",time:"â±ï¸",send:"ðŸ’Œ",trash:"ðŸ—‘ï¸",edit:"âœï¸",lock:"ðŸ”’",phone:"ðŸ“±",tablet:"ðŸ“Ÿ",desktop:"ðŸ’»"},Z=i=>i?i<60?`${i} phÃºt`:`${Math.floor(i/60)}h ${i%60}p`:"0 phÃºt",T=i=>i?new Date(i).toLocaleDateString("vi-VN"):"",ee=i=>new Intl.NumberFormat("vi-VN").format(i)+"Ä‘";function le(){const i=U(),{account:r,children:p,subscription:n,devices:v,planInfo:x,updateAccount:se,upgradePlan:$,removeDevice:L,renameDevice:G,changeParentPin:B,signOut:E}=W(),[b,I]=l.useState("overview"),[a,P]=l.useState(null),[f,X]=l.useState(null),[S,A]=l.useState([]),[te,_]=l.useState(!1),[V,y]=l.useState(!1),[z,w]=l.useState(!1),[j,k]=l.useState(null);l.useEffect(()=>{p.length>0&&!a&&P(p[0])},[p]),l.useEffect(()=>{a&&H(a.id)},[a]);const H=async s=>{_(!0);try{const{data:d}=await C.rpc("get_child_stats",{p_child_id:s,p_days:7});X(d);const{data:c}=await C.from("learning_logs").select("*").eq("child_id",s).order("created_at",{ascending:!1}).limit(20);A(c||[])}catch(d){console.error("Load error:",d)}_(!1)},q=()=>e.jsxs("div",{className:"space-y-4",children:[p.length>1&&e.jsx("div",{className:"flex gap-2 overflow-x-auto pb-2",children:p.map(s=>e.jsxs("button",{onClick:()=>P(s),className:`flex-shrink-0 px-4 py-2 rounded-full flex items-center gap-2 transition ${(a==null?void 0:a.id)===s.id?"bg-indigo-500 text-white":"bg-white text-gray-700 border"}`,children:[e.jsx("span",{children:s.avatar}),e.jsx("span",{className:"font-medium",children:s.name})]},s.id))}),a&&e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center gap-4 mb-4",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-gradient-to-br from-indigo-400 to-purple-400 flex items-center justify-center text-3xl",children:a.avatar}),e.jsxs("div",{className:"flex-1",children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800",children:a.name}),e.jsxs("p",{className:"text-gray-500",children:[a.age?`${a.age} tuá»•i â€¢ `:"","Level ",a.level||1]})]}),e.jsxs("button",{onClick:()=>y(!0),className:"px-4 py-2 bg-pink-500 text-white rounded-xl font-medium",children:[t.send," Äá»™ng viÃªn"]})]}),e.jsx("div",{className:"grid grid-cols-4 gap-2",children:[{icon:t.star,value:a.xp||0,label:"XP",color:"text-yellow-500"},{icon:t.fire,value:a.streak||0,label:"Streak",color:"text-orange-500"},{icon:t.book,value:a.total_lessons||0,label:"BÃ i há»c",color:"text-blue-500"},{icon:t.game,value:a.total_games||0,label:"Games",color:"text-pink-500"}].map((s,d)=>e.jsxs("div",{className:"bg-gray-50 rounded-xl p-3 text-center",children:[e.jsx("div",{className:`text-xl ${s.color}`,children:s.icon}),e.jsx("div",{className:"text-lg font-bold text-gray-800",children:s.value}),e.jsx("div",{className:"text-xs text-gray-500",children:s.label})]},d))})]}),f&&e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 mb-3",children:[t.chart," Thá»‘ng kÃª 7 ngÃ y"]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-blue-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-blue-600",children:f.total_lessons||0}),e.jsx("div",{className:"text-sm text-blue-600/70",children:"BÃ i há»c"})]}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-green-600",children:Z(f.total_time||0)}),e.jsx("div",{className:"text-sm text-green-600/70",children:"Thá»i gian"})]}),e.jsxs("div",{className:"bg-purple-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-purple-600",children:f.total_xp||0}),e.jsx("div",{className:"text-sm text-purple-600/70",children:"XP kiáº¿m Ä‘Æ°á»£c"})]}),e.jsxs("div",{className:"bg-orange-50 rounded-xl p-3",children:[e.jsx("div",{className:"text-2xl font-bold text-orange-600",children:f.days_active||0}),e.jsx("div",{className:"text-sm text-orange-600/70",children:"NgÃ y há»c"})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 mb-3",children:[t.time," Hoáº¡t Ä‘á»™ng gáº§n Ä‘Ã¢y"]}),S.length===0?e.jsx("p",{className:"text-center text-gray-400 py-4",children:"ChÆ°a cÃ³ hoáº¡t Ä‘á»™ng"}):e.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:S.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-2 hover:bg-gray-50 rounded-lg",children:[e.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${s.type==="lesson"?"bg-blue-100 text-blue-600":s.type==="game"?"bg-pink-100 text-pink-600":"bg-green-100 text-green-600"}`,children:s.type==="lesson"?t.book:s.type==="game"?t.game:t.star}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"text-sm font-medium text-gray-800",children:s.title}),e.jsx("p",{className:"text-xs text-gray-500",children:T(s.created_at)})]}),e.jsxs("span",{className:"text-sm text-indigo-600 font-medium",children:["+",s.xp_earned||0," XP"]})]},s.id))})]})]}),R=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("h4",{className:"font-semibold text-gray-700",children:[t.device," Thiáº¿t bá»‹ Ä‘ang dÃ¹ng"]}),e.jsxs("span",{className:"text-sm text-gray-500",children:[v.length,"/",(n==null?void 0:n.max_devices)||1]})]}),e.jsxs("div",{className:"space-y-3",children:[v.map(s=>e.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-50 rounded-xl",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-indigo-100 flex items-center justify-center text-2xl",children:s.device_type==="phone"?t.phone:s.device_type==="tablet"?t.tablet:t.desktop}),e.jsxs("div",{className:"flex-1",children:[e.jsx("p",{className:"font-medium text-gray-800",children:s.device_name||"Thiáº¿t bá»‹"}),e.jsxs("p",{className:"text-xs text-gray-500",children:[s.os," â€¢ ",s.browser]})]}),e.jsx("button",{onClick:()=>k(s),className:"p-2 text-gray-400 hover:text-gray-600",children:t.edit}),e.jsx("button",{onClick:async()=>{confirm("XÃ³a thiáº¿t bá»‹ nÃ y?")&&await L(s.id)},className:"p-2 text-red-400 hover:text-red-600",children:t.trash})]},s.id)),v.length===0&&e.jsx("p",{className:"text-center text-gray-400 py-4",children:"ChÆ°a cÃ³ thiáº¿t bá»‹ nÃ o"})]})]}),e.jsx("div",{className:"bg-blue-50 rounded-2xl p-4",children:e.jsxs("p",{className:"text-sm text-blue-700",children:[e.jsx("strong",{children:"ðŸ’¡ Máº¹o:"})," XÃ³a thiáº¿t bá»‹ cÅ© Ä‘á»ƒ thÃªm thiáº¿t bá»‹ má»›i. GÃ³i ",x==null?void 0:x.name," cho phÃ©p ",x==null?void 0:x.maxDevices," thiáº¿t bá»‹."]})})]}),K=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-gradient-to-r from-indigo-500 to-purple-500 rounded-2xl p-4 text-white",children:[e.jsxs("div",{className:"flex items-center gap-3 mb-3",children:[e.jsx("div",{className:"w-12 h-12 rounded-full bg-white/20 flex items-center justify-center text-2xl",children:t.crown}),e.jsxs("div",{children:[e.jsx("p",{className:"text-white/70 text-sm",children:"GÃ³i hiá»‡n táº¡i"}),e.jsx("p",{className:"text-xl font-bold",children:x==null?void 0:x.name})]})]}),e.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:(n==null?void 0:n.max_devices)||1}),e.jsx("div",{className:"text-xs text-white/70",children:"Thiáº¿t bá»‹"})]}),e.jsxs("div",{className:"bg-white/10 rounded-lg p-2 text-center",children:[e.jsx("div",{className:"text-lg font-bold",children:(n==null?void 0:n.max_children)||1}),e.jsx("div",{className:"text-xs text-white/70",children:"BÃ©"})]})]})]}),e.jsx("h4",{className:"font-semibold text-gray-700",children:"NÃ¢ng cáº¥p gÃ³i"}),[{plan:"plus",name:"Plus",price:49e3,devices:3,children:3,popular:!0},{plan:"family",name:"Gia Ä‘Ã¬nh",price:79e3,devices:5,children:5,popular:!1}].map(s=>e.jsxs("div",{className:`bg-white rounded-2xl p-4 shadow-sm border-2 ${s.popular?"border-indigo-500":"border-transparent"}`,children:[s.popular&&e.jsx("span",{className:"inline-block px-2 py-1 bg-indigo-500 text-white text-xs font-medium rounded-full mb-2",children:"Phá»• biáº¿n"}),e.jsxs("div",{className:"flex items-center justify-between mb-3",children:[e.jsxs("div",{children:[e.jsx("h5",{className:"text-lg font-bold text-gray-800",children:s.name}),e.jsxs("p",{className:"text-2xl font-bold text-indigo-600",children:[ee(s.price),e.jsx("span",{className:"text-sm text-gray-500",children:"/thÃ¡ng"})]})]}),e.jsx("button",{onClick:()=>$(s.plan),disabled:(n==null?void 0:n.plan)===s.plan,className:`px-4 py-2 rounded-xl font-medium ${(n==null?void 0:n.plan)===s.plan?"bg-gray-100 text-gray-400":"bg-indigo-500 text-white hover:bg-indigo-600"}`,children:(n==null?void 0:n.plan)===s.plan?"Äang dÃ¹ng":"NÃ¢ng cáº¥p"})]}),e.jsxs("div",{className:"flex gap-4 text-sm text-gray-600",children:[e.jsxs("span",{children:[t.device," ",s.devices," thiáº¿t bá»‹"]}),e.jsxs("span",{children:[t.child," ",s.children," bÃ©"]})]})]},s.plan))]}),O=()=>e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsx("h4",{className:"font-semibold text-gray-700 mb-3",children:"ThÃ´ng tin tÃ i khoáº£n"}),e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"Email"}),e.jsx("span",{className:"font-medium text-gray-800",children:r==null?void 0:r.email})]}),e.jsxs("div",{className:"flex items-center justify-between py-2 border-b",children:[e.jsx("span",{className:"text-gray-600",children:"TÃªn"}),e.jsx("span",{className:"font-medium text-gray-800",children:r==null?void 0:r.parent_name})]}),e.jsxs("div",{className:"flex items-center justify-between py-2",children:[e.jsx("span",{className:"text-gray-600",children:"NgÃ y táº¡o"}),e.jsx("span",{className:"font-medium text-gray-800",children:T(r==null?void 0:r.created_at)})]})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsxs("h4",{className:"font-semibold text-gray-700 mb-3",children:[t.lock," Báº£o máº­t"]}),e.jsxs("button",{onClick:()=>w(!0),className:"w-full flex items-center justify-between py-3 px-4 bg-gray-50 rounded-xl hover:bg-gray-100 transition",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("span",{className:"text-xl",children:t.lock}),e.jsx("span",{className:"font-medium text-gray-700",children:"Äá»•i mÃ£ PIN"})]}),e.jsx("span",{className:"text-gray-400",children:"â€º"})]})]}),e.jsxs("div",{className:"bg-white rounded-2xl p-4 shadow-sm",children:[e.jsx("h4",{className:"font-semibold text-red-500 mb-3",children:"âš ï¸ VÃ¹ng nguy hiá»ƒm"}),e.jsx("button",{onClick:()=>{confirm("Báº¡n cÃ³ cháº¯c muá»‘n Ä‘Äƒng xuáº¥t?")&&(E(),i("/auth"))},className:"w-full py-3 bg-red-50 text-red-600 rounded-xl font-medium hover:bg-red-100",children:"ðŸšª ÄÄƒng xuáº¥t"})]})]}),F=()=>{const[s,d]=l.useState(""),[c,h]=l.useState(!1),u=["Con giá»i láº¯m! ðŸ’ª","Bá»‘/Máº¹ tá»± hÃ o vá» con! ðŸŒŸ","Cá»‘ lÃªn nhÃ©! ðŸŽ¯","YÃªu con! â¤ï¸"],N=async()=>{if(!(!s.trim()||!a)){h(!0);try{await C.from("encouragements").insert({account_id:r.id,child_id:a.id,message:s.trim()}),alert(`âœ… ÄÃ£ gá»­i Ä‘áº¿n ${a.name}!`),y(!1),d("")}catch{alert("âŒ KhÃ´ng thá»ƒ gá»­i")}h(!1)}};return V?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:[t.send," Gá»­i Ä‘á»™ng viÃªn cho ",a==null?void 0:a.name]}),e.jsx("div",{className:"flex flex-wrap gap-2 mb-4",children:u.map((o,g)=>e.jsx("button",{onClick:()=>d(o),className:"px-3 py-1 bg-pink-100 text-pink-700 rounded-full text-sm hover:bg-pink-200",children:o},g))}),e.jsx("textarea",{value:s,onChange:o=>d(o.target.value),placeholder:"Viáº¿t lá»i nháº¯n...",className:"w-full p-3 border rounded-xl h-24 resize-none focus:ring-2 focus:ring-pink-500 focus:outline-none"}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>y(!1),className:"flex-1 py-3 border rounded-xl font-medium text-gray-600 hover:bg-gray-50",children:"Há»§y"}),e.jsx("button",{onClick:N,disabled:!s.trim()||c,className:"flex-1 py-3 bg-pink-500 text-white rounded-xl font-medium disabled:opacity-50",children:c?"Äang gá»­i...":"Gá»­i ðŸ’Œ"})]})]})}):null},Y=()=>{const[s,d]=l.useState(""),[c,h]=l.useState(""),[u,N]=l.useState(""),[o,g]=l.useState(""),[M,D]=l.useState(!1),Q=async()=>{if(g(""),s!==(r==null?void 0:r.parent_pin)){g("MÃ£ PIN hiá»‡n táº¡i khÃ´ng Ä‘Ãºng");return}if(c.length!==4||!/^\d{4}$/.test(c)){g("MÃ£ PIN má»›i pháº£i lÃ  4 chá»¯ sá»‘");return}if(c!==u){g("MÃ£ PIN xÃ¡c nháº­n khÃ´ng khá»›p");return}D(!0);const m=await B(c);m.error?g(m.error):(alert("âœ… ÄÃ£ Ä‘á»•i mÃ£ PIN!"),w(!1)),D(!1)};return z?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:[t.lock," Äá»•i mÃ£ PIN"]}),o&&e.jsxs("div",{className:"mb-4 p-3 bg-red-50 text-red-600 rounded-xl text-sm",children:["âš ï¸ ",o]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PIN hiá»‡n táº¡i"}),e.jsx("input",{type:"password",value:s,onChange:m=>d(m.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"â€¢â€¢â€¢â€¢",maxLength:4,className:"w-full px-4 py-3 border rounded-xl text-center text-xl tracking-widest"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"PIN má»›i"}),e.jsx("input",{type:"password",value:c,onChange:m=>h(m.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"â€¢â€¢â€¢â€¢",maxLength:4,className:"w-full px-4 py-3 border rounded-xl text-center text-xl tracking-widest"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"XÃ¡c nháº­n PIN má»›i"}),e.jsx("input",{type:"password",value:u,onChange:m=>N(m.target.value.replace(/\D/g,"").slice(0,4)),placeholder:"â€¢â€¢â€¢â€¢",maxLength:4,className:"w-full px-4 py-3 border rounded-xl text-center text-xl tracking-widest"})]})]}),e.jsxs("div",{className:"flex gap-3 mt-6",children:[e.jsx("button",{onClick:()=>w(!1),className:"flex-1 py-3 border rounded-xl font-medium text-gray-600 hover:bg-gray-50",children:"Há»§y"}),e.jsx("button",{onClick:Q,disabled:M,className:"flex-1 py-3 bg-indigo-500 text-white rounded-xl font-medium disabled:opacity-50",children:M?"Äang lÆ°u...":"Äá»•i PIN"})]})]})}):null},J=()=>{const[s,d]=l.useState((j==null?void 0:j.device_name)||""),[c,h]=l.useState(!1),u=async()=>{s.trim()&&(h(!0),await G(j.id,s.trim()),k(null),h(!1))};return j?e.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50 p-4",children:e.jsxs("div",{className:"bg-white rounded-2xl p-6 w-full max-w-md",children:[e.jsxs("h3",{className:"text-xl font-bold text-gray-800 mb-4",children:[t.edit," Äá»•i tÃªn thiáº¿t bá»‹"]}),e.jsx("input",{type:"text",value:s,onChange:N=>d(N.target.value),placeholder:"VD: iPhone cá»§a Máº¹",className:"w-full px-4 py-3 border rounded-xl"}),e.jsxs("div",{className:"flex gap-3 mt-4",children:[e.jsx("button",{onClick:()=>k(null),className:"flex-1 py-3 border rounded-xl font-medium text-gray-600 hover:bg-gray-50",children:"Há»§y"}),e.jsx("button",{onClick:u,disabled:!s.trim()||c,className:"flex-1 py-3 bg-indigo-500 text-white rounded-xl font-medium disabled:opacity-50",children:c?"Äang lÆ°u...":"LÆ°u"})]})]})}):null};return e.jsxs("div",{className:"min-h-screen bg-gray-100",children:[e.jsx("div",{className:"bg-gradient-to-r from-purple-600 to-pink-500 text-white p-4 pb-20",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("button",{onClick:()=>i("/select-role"),className:"w-10 h-10 rounded-full bg-white/20 flex items-center justify-center",children:t.back}),e.jsx("h1",{className:"text-xl font-bold",children:"Khu vá»±c Phá»¥ huynh"}),e.jsx("div",{className:"w-10"})]})}),e.jsx("div",{className:"px-4 -mt-14",children:e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-2 flex gap-1 overflow-x-auto",children:[{id:"overview",icon:t.chart,label:"Tá»•ng quan"},{id:"devices",icon:t.device,label:"Thiáº¿t bá»‹"},{id:"subscription",icon:t.crown,label:"GÃ³i"},{id:"settings",icon:t.settings,label:"CÃ i Ä‘áº·t"}].map(s=>e.jsxs("button",{onClick:()=>I(s.id),className:`flex-1 min-w-[80px] py-2 px-3 rounded-xl font-medium text-sm transition flex flex-col items-center gap-1 ${b===s.id?"bg-purple-500 text-white":"text-gray-600 hover:bg-gray-100"}`,children:[e.jsx("span",{children:s.icon}),e.jsx("span",{children:s.label})]},s.id))})}),e.jsxs("div",{className:"p-4 pt-6",children:[b==="overview"&&q(),b==="devices"&&R(),b==="subscription"&&K(),b==="settings"&&O()]}),e.jsx(F,{}),e.jsx(Y,{}),e.jsx(J,{})]})}export{le as default};
