import{c as D,u as G,a as K,b as A,r as n,j as e}from"./index-DujQnjn7.js";import{a as Y}from"./stories-BUclpc1Z.js";import{A as J}from"./arrow-left-CUU1O6Xt.js";import{m as x}from"./proxy-BFCT-_i_.js";import{L as Z}from"./lock-CKTROG7E.js";import{A as ee}from"./index-CXgneoSt.js";import{B as se}from"./book-open-DaMDJ4UX.js";import{C as te}from"./chevron-left-CtTsAgSs.js";import{S as F}from"./sparkles-Bo_34rIs.js";import{C as ae}from"./chevron-right-CIM0EHvB.js";import{S as re}from"./star-CSWSp93I.js";import{c as R}from"./createLucideIcon-C1f9I39M.js";import{V as ne}from"./volume-2-DJzuLhS_.js";import{V as le}from"./volume-x-CU8sjH0J.js";import{C as oe}from"./check-circle-DqKfnpJG.js";import{X as ie}from"./x-circle-CnafkfRX.js";/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ce=R("Loader2",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=R("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.330.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=R("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]),he="nlzVb59O6i3UHC0hO1qh6lTyhUGD1fWb",xe="https://api.fpt.ai/hmi/tts/v5",ue=()=>{const[s,l]=n.useState(!1),[i,m]=n.useState(!1),[g,b]=n.useState(!1),[f,j]=n.useState(null),t=n.useRef(null);n.useEffect(()=>(t.current=new Audio,t.current.onplay=()=>{l(!0),b(!1)},t.current.onended=()=>{l(!1),m(!1)},t.current.onerror=o=>{console.error("Audio error:",o),l(!1),b(!1),j("Kh√¥ng th·ªÉ ph√°t √¢m thanh")},()=>{t.current&&(t.current.pause(),t.current=null)}),[]);const w=async(o,r=30)=>{for(let u=0;u<r;u++){try{if((await fetch(o,{method:"HEAD"})).ok)return!0}catch{}await new Promise(y=>setTimeout(y,500))}return!1},h=n.useCallback(async o=>{if(o){b(!0),j(null);try{const r=await fetch(xe,{method:"POST",headers:{api_key:he,voice:"banmai",speed:"0",prosody:"1","Content-Type":"text/plain; charset=utf-8"},body:o});if(!r.ok)throw new Error(`HTTP error! status: ${r.status}`);const u=await r.json();if(console.log("FPT.AI Response:",u),u.error===0&&u.async){const y=u.async;if(console.log("Audio URL:",y),await w(y)&&t.current)t.current.src=y,await t.current.play();else throw new Error("Audio file not ready after waiting")}else throw new Error(u.message||"L·ªói t·ª´ FPT.AI")}catch(r){console.error("FPT TTS Error:",r),j(r.message),b(!1),N(o)}}},[]),N=n.useCallback(o=>{if(!("speechSynthesis"in window))return;console.log("Using fallback Web Speech API"),window.speechSynthesis.cancel();const r=new SpeechSynthesisUtterance(o);r.lang="vi-VN",r.rate=.9,r.onstart=()=>l(!0),r.onend=()=>{l(!1),m(!1)},window.speechSynthesis.speak(r)},[]),T=n.useCallback(()=>{t.current&&!t.current.paused&&(t.current.pause(),m(!0))},[]),c=n.useCallback(()=>{t.current&&t.current.paused&&(t.current.play(),m(!1))},[]),d=n.useCallback(()=>{var o;t.current&&(t.current.pause(),t.current.currentTime=0),(o=window.speechSynthesis)==null||o.cancel(),l(!1),m(!1),b(!1)},[]);return{speak:h,pause:T,resume:c,stop:d,isSpeaking:s,isPaused:i,isLoading:g,error:f}},pe=({chaptersNeeded:s,onBack:l})=>e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-gray-100 to-gray-200 flex items-center justify-center p-4",children:e.jsxs(x.div,{initial:{scale:.9,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-3xl p-8 text-center max-w-sm w-full shadow-xl",children:[e.jsx(x.div,{animate:{y:[0,-10,0]},transition:{duration:2,repeat:1/0},className:"text-7xl mb-4",children:"üîí"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Ch∆∞∆°ng n√†y b·ªã kh√≥a!"}),e.jsxs("p",{className:"text-gray-600 mb-6",children:["H·ªçc b√†i th√™m ",e.jsxs("strong",{className:"text-orange-500",children:[s," ng√†y"]})," li√™n ti·∫øp ƒë·ªÉ m·ªü kh√≥a ch∆∞∆°ng n√†y nh√©!"]}),e.jsx("div",{className:"bg-amber-50 rounded-xl p-4 mb-6",children:e.jsxs("p",{className:"text-amber-700 text-sm",children:["üí° ",e.jsx("strong",{children:"M·∫πo:"})," M·ªói ng√†y h·ªçc li√™n ti·∫øp s·∫Ω m·ªü th√™m 1 ch∆∞∆°ng truy·ªán!"]})}),e.jsx("button",{onClick:l,className:"w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-bold",children:"Quay l·∫°i h·ªçc b√†i"})]})}),ge=({chapter:s,onCorrect:l,onWrong:i})=>{const{playSound:m}=A(),[g,b]=n.useState(null),[f,j]=n.useState(!1),t=w=>{f||(b(w),j(!0),w===s.answer?(m("correct"),setTimeout(l,1500)):(m("wrong"),setTimeout(i,1500)))};return e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-purple-50 to-pink-50 rounded-2xl p-6 mt-6",children:[e.jsxs("h3",{className:"font-bold text-purple-700 mb-4 flex items-center gap-2",children:[e.jsx(F,{className:"w-5 h-5"})," C√¢u h·ªèi ki·ªÉm tra"]}),e.jsx("p",{className:"text-gray-800 font-medium mb-4",children:s.question}),e.jsx("div",{className:"space-y-2",children:s.options.map((w,h)=>{let N="bg-white border-gray-200 hover:border-purple-300";return f?h===s.answer?N="bg-green-100 border-green-500":h===g&&(N="bg-red-100 border-red-500"):g===h&&(N="bg-purple-100 border-purple-500"),e.jsxs(x.button,{whileTap:f?{}:{scale:.98},onClick:()=>t(h),disabled:f,className:`w-full p-4 rounded-xl border-2 text-left flex items-center gap-3 transition-all ${N}`,children:[e.jsx("span",{className:"w-8 h-8 rounded-full bg-gray-100 flex items-center justify-center font-bold text-gray-600",children:String.fromCharCode(65+h)}),e.jsx("span",{className:"flex-1 text-gray-800",children:w}),f&&h===s.answer&&e.jsx(oe,{className:"w-6 h-6 text-green-500"}),f&&h===g&&h!==s.answer&&e.jsx(ie,{className:"w-6 h-6 text-red-500"})]},h)})}),f&&e.jsx(x.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`mt-4 p-4 rounded-xl text-center ${g===s.answer?"bg-green-100 text-green-700":"bg-orange-100 text-orange-700"}`,children:g===s.answer?e.jsx("p",{className:"font-bold",children:"üéâ ƒê√∫ng r·ªìi! Gi·ªèi qu√°!"}):e.jsxs("p",{className:"font-bold",children:["üí™ ƒê√°p √°n ƒë√∫ng l√†: ",s.options[s.answer]]})})]})},fe=({story:s,onRestart:l,onBack:i})=>{const{playSound:m}=A();return n.useEffect(()=>{m("achievement")},[]),e.jsx("div",{className:"min-h-screen bg-gradient-to-b from-amber-400 to-orange-500 flex items-center justify-center p-4",children:e.jsxs(x.div,{initial:{scale:0,opacity:0},animate:{scale:1,opacity:1},className:"bg-white rounded-3xl p-8 text-center max-w-sm w-full shadow-2xl",children:[e.jsx(x.div,{animate:{rotate:[0,10,-10,0],scale:[1,1.2,1]},transition:{duration:.5,repeat:3},className:"text-7xl mb-4",children:"üèÜ"}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-2",children:"Ho√†n th√†nh truy·ªán!"}),e.jsx("p",{className:"text-gray-600 mb-4",children:s.title}),e.jsx("div",{className:"flex justify-center gap-1 mb-6",children:[1,2,3].map(g=>e.jsx(re,{className:"w-10 h-10 text-yellow-400 fill-yellow-400"},g))}),e.jsxs("div",{className:"bg-green-50 rounded-xl p-4 mb-6",children:[e.jsx("p",{className:"text-green-700 font-bold text-lg",children:"+50 XP"}),e.jsx("p",{className:"text-green-600 text-sm",children:"Ph·∫ßn th∆∞·ªüng ho√†n th√†nh truy·ªán!"})]}),e.jsxs("div",{className:"space-y-3",children:[e.jsx("button",{onClick:l,className:"w-full py-3 bg-gradient-to-r from-amber-500 to-orange-500 text-white rounded-xl font-bold",children:"üìñ ƒê·ªçc l·∫°i t·ª´ ƒë·∫ßu"}),e.jsx("button",{onClick:i,className:"w-full py-3 bg-gray-100 text-gray-700 rounded-xl font-medium",children:"Ch·ªçn truy·ªán kh√°c"})]})]})})},be=({isPlaying:s,isPaused:l,isLoading:i,onPlay:m,onPause:g,onResume:b,onStop:f})=>e.jsx("div",{className:"flex items-center gap-2",children:i?e.jsxs("div",{className:"flex items-center gap-2 px-4 py-2 bg-blue-100 text-blue-600 rounded-full",children:[e.jsx(ce,{className:"w-5 h-5 animate-spin"}),e.jsx("span",{children:"ƒêang t·∫£i..."})]}):s?e.jsxs("div",{className:"flex items-center gap-2",children:[l?e.jsx(x.button,{whileTap:{scale:.95},onClick:b,className:"p-3 bg-green-500 text-white rounded-full shadow-lg",children:e.jsx(me,{className:"w-6 h-6"})}):e.jsx(x.button,{whileTap:{scale:.95},onClick:g,className:"p-3 bg-amber-500 text-white rounded-full shadow-lg",children:e.jsx(de,{className:"w-6 h-6"})}),e.jsx(x.button,{whileTap:{scale:.95},onClick:f,className:"p-3 bg-red-500 text-white rounded-full shadow-lg",children:e.jsx(le,{className:"w-6 h-6"})}),!l&&e.jsx("div",{className:"flex items-center gap-1 ml-2",children:[1,2,3,4,5].map(j=>e.jsx(x.div,{animate:{height:[8,24,8]},transition:{duration:.5,repeat:1/0,delay:j*.1},className:"w-1.5 bg-green-500 rounded-full"},j))})]}):e.jsxs(x.button,{whileTap:{scale:.95},onClick:m,className:"flex items-center gap-2 px-5 py-3 bg-gradient-to-r from-green-500 to-emerald-500 text-white rounded-full font-bold shadow-lg",children:[e.jsx(ne,{className:"w-6 h-6"}),e.jsx("span",{children:"Nghe k·ªÉ"})]})});function $e(){var E,I;const{storyId:s}=D(),l=G(),{currentChild:i,updateChild:m}=K(),{playSound:g}=A(),{speak:b,pause:f,resume:j,stop:t,isSpeaking:w,isPaused:h,isLoading:N,error:T}=ue(),c=Y(s),[d,o]=n.useState(0),[r,u]=n.useState(!1),[y,C]=n.useState(!1),[$,L]=n.useState(!1),z=((E=i==null?void 0:i.stats)==null?void 0:E.streak)||0,v=((I=i==null?void 0:i.storyProgress)==null?void 0:I[s])||{},P=Math.min(Math.max(1,z+1),(c==null?void 0:c.totalChapters)||0);if(n.useEffect(()=>{v.lastChapter&&v.lastChapter>0&&o(Math.min(v.lastChapter,P-1))},[s]),n.useEffect(()=>{t()},[d]),!c)return e.jsx("div",{className:"min-h-screen flex items-center justify-center",children:e.jsx("p",{className:"text-gray-500",children:"Truy·ªán kh√¥ng t·ªìn t·∫°i"})});const k=c.chapters[d],M=d>=P,U=d-P+1,Q=()=>{g("click");const a=`${k.title}. ${k.content}`;b(a)},H=a=>{const p={...i};p.storyProgress||(p.storyProgress={}),p.storyProgress[s]||(p.storyProgress[s]={lastChapter:0,completed:!1}),p.storyProgress[s].lastChapter=Math.max(p.storyProgress[s].lastChapter,a+1),m(p)},V=()=>{const a={...i};a.storyProgress||(a.storyProgress={}),a.storyProgress[s]||(a.storyProgress[s]={lastChapter:0,completed:!1}),a.storyProgress[s].completed=!0,a.storyProgress[s].lastChapter=c.totalChapters,a.xp=(a.xp||0)+50,a.pet&&(a.pet.xp=(a.pet.xp||0)+20,a.pet.lastFed=Date.now()),m(a),L(!0)},B=()=>{if(t(),!r){u(!0);return}y&&(H(d),d<c.chapters.length-1?(o(a=>a+1),u(!1),C(!1)):V())},_=()=>{t(),d>0&&(o(a=>a-1),u(!1),C(!1))},q=()=>{C(!0)},O=()=>{C(!0)};return M?e.jsx(pe,{chaptersNeeded:U,onBack:()=>l("/stories")}):$?e.jsx(fe,{story:c,onRestart:()=>{o(0),L(!1),u(!1),t()},onBack:()=>{t(),l("/stories")}}):e.jsxs("div",{className:"min-h-screen bg-gradient-to-b from-amber-50 to-orange-50 pb-32",children:[e.jsxs("div",{className:`bg-gradient-to-r ${c.color} text-white px-4 py-4`,children:[e.jsxs("div",{className:"flex items-center justify-between mb-2",children:[e.jsx("button",{onClick:()=>{t(),l("/stories")},className:"p-2 rounded-full hover:bg-white/20",children:e.jsx(J,{className:"w-6 h-6"})}),e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"font-bold",children:c.title}),e.jsxs("p",{className:"text-sm text-white/80",children:["Ch∆∞∆°ng ",d+1,"/",c.totalChapters]})]}),e.jsx("div",{className:"w-10"})]}),e.jsx("div",{className:"h-2 bg-white/30 rounded-full overflow-hidden",children:e.jsx(x.div,{initial:{width:0},animate:{width:`${(d+1)/c.totalChapters*100}%`},className:"h-full bg-white rounded-full"})})]}),e.jsx("div",{className:"px-4 py-3 overflow-x-auto",children:e.jsx("div",{className:"flex gap-2",children:c.chapters.map((a,p)=>{const S=p<P,W=p===d,X=p<(v.lastChapter||0);return e.jsx("button",{onClick:()=>{S&&(t(),o(p),u(!1),C(!1))},disabled:!S,className:`flex-shrink-0 w-10 h-10 rounded-full flex items-center justify-center font-bold text-sm transition-all ${W?"bg-gradient-to-r from-amber-500 to-orange-500 text-white scale-110":X?"bg-green-100 text-green-600 border-2 border-green-400":S?"bg-white text-gray-600 border-2 border-gray-200":"bg-gray-100 text-gray-400"}`,children:S?p+1:e.jsx(Z,{className:"w-4 h-4"})},p)})})}),e.jsx("div",{className:"px-4 mb-4",children:e.jsxs("div",{className:"bg-gradient-to-r from-green-50 to-emerald-50 rounded-2xl p-4 shadow-lg border-2 border-green-200",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row items-center justify-between gap-3",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(x.div,{animate:{scale:w&&!h?[1,1.2,1]:1},transition:{duration:.5,repeat:w&&!h?1/0:0},className:"w-12 h-12 bg-gradient-to-r from-green-400 to-emerald-400 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-2xl",children:"üéß"})}),e.jsxs("div",{children:[e.jsx("p",{className:"font-bold text-green-800",children:"Nghe k·ªÉ chuy·ªán"}),e.jsx("p",{className:"text-xs text-green-600",children:"Gi·ªçng Ban Mai - FPT.AI"})]})]}),e.jsx(be,{isPlaying:w,isPaused:h,isLoading:N,onPlay:Q,onPause:f,onResume:j,onStop:t})]}),T&&e.jsx("div",{className:"mt-3 p-2 bg-yellow-100 rounded-lg",children:e.jsx("p",{className:"text-yellow-700 text-xs",children:"‚ö†Ô∏è ƒêang d√πng gi·ªçng ƒë·ªçc d·ª± ph√≤ng"})})]})}),e.jsx("div",{className:"px-4",children:e.jsx(ee,{mode:"wait",children:e.jsxs(x.div,{initial:{opacity:0,x:50},animate:{opacity:1,x:0},exit:{opacity:0,x:-50},className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("h2",{className:"text-xl font-bold text-gray-800 mb-4 flex items-center gap-2",children:[e.jsx(se,{className:"w-6 h-6 text-amber-500"}),k.title]}),e.jsx("div",{className:"text-center text-6xl mb-4 py-6 bg-gradient-to-r from-amber-50 to-orange-50 rounded-xl",children:k.image}),e.jsx("div",{className:"text-gray-700 leading-loose whitespace-pre-line text-lg",children:k.content}),r&&e.jsx(ge,{chapter:k,onCorrect:q,onWrong:O})]},d)})}),e.jsx("div",{className:"fixed bottom-20 left-0 right-0 bg-white border-t shadow-lg px-4 py-3",children:e.jsxs("div",{className:"flex gap-3",children:[e.jsxs("button",{onClick:_,disabled:d===0,className:`flex-1 py-3 rounded-xl font-bold flex items-center justify-center gap-2 ${d===0?"bg-gray-100 text-gray-400":"bg-gray-200 text-gray-700"}`,children:[e.jsx(te,{className:"w-5 h-5"})," Tr∆∞·ªõc"]}),e.jsx("button",{onClick:B,disabled:r&&!y,className:`flex-1 py-3 rounded-xl font-bold flex items-center justify-center gap-2 ${r&&!y?"bg-gray-200 text-gray-400":"bg-gradient-to-r from-amber-500 to-orange-500 text-white shadow-lg"}`,children:r?d<c.chapters.length-1?e.jsxs(e.Fragment,{children:["Ch∆∞∆°ng ti·∫øp ",e.jsx(ae,{className:"w-5 h-5"})]}):e.jsx(e.Fragment,{children:"Ho√†n th√†nh üéâ"}):e.jsxs(e.Fragment,{children:["Tr·∫£ l·ªùi c√¢u h·ªèi ",e.jsx(F,{className:"w-5 h-5"})]})})]})})]})}export{$e as default};
